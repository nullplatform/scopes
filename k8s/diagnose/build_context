#!/bin/bash

eval "$(echo "$CONTEXT" | jq -r '.scope.nrn | "
export ORGANIZATION_ID=\(capture("organization=(?<id>\\d+)").id)
export ACCOUNT_ID=\(capture("account=(?<id>\\d+)").id)
export NAMESPACE_ID=\(capture("namespace=(?<id>\\d+)").id)
export APPLICATION_ID=\(capture("application=(?<id>\\d+)").id)
"')"

LABEL_SELECTOR="scope_id=$SCOPE_ID"

CURRENT_ACTIVE_DEPLOYMENT=$(echo "$CONTEXT" | jq -r '.scope.current_active_deployment')
if [ -n "${CURRENT_ACTIVE_DEPLOYMENT:-}" ]; then
    LABEL_SELECTOR="$LABEL_SELECTOR,deployment_id=$CURRENT_ACTIVE_DEPLOYMENT"
fi

export LABEL_SELECTOR
export CONTEXT

echo "$CONTEXT"