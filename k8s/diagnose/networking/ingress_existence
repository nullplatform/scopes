#!/bin/bash
# Check: Ingress Existence
# Verifies that ingress resources exist in the namespace

# Validate ingresses exist
require_ingresses || return 0

# Read ingresses from pre-collected data
INGRESSES=$(jq -r '.items[].metadata.name' "$INGRESSES_FILE" 2>/dev/null | tr '\n' ' ')

INGRESS_COUNT=$(echo "$INGRESSES" | wc -w)
print_success "Found $INGRESS_COUNT ingress(es): $INGRESSES"

# Show basic ingress info
for INGRESS_NAME in $INGRESSES; do
    # Get hosts from pre-collected data
    HOSTS=$(jq -r --arg name "$INGRESS_NAME" '.items[] | select(.metadata.name == $name) | .spec.rules[].host' "$INGRESSES_FILE" 2>/dev/null | tr '\n' ' ')
    print_info "  $INGRESS_NAME hosts: $HOSTS"
done

update_check_result --status "success" --evidence "{}"